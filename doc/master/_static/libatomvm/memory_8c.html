<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libAtomVM: /home/runner/work/AtomVM/AtomVM/src/libAtomVM/memory.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="AVM-alt.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libAtomVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_71a31c0df5161b11b9c2da40f7f3343f.html">libAtomVM</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">memory.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="context_8h_source.html">context.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="debug_8h_source.html">debug.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dictionary_8h_source.html">dictionary.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="erl__nif__priv_8h_source.html">erl_nif_priv.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="list_8h_source.html">list.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="refc__binary_8h_source.html">refc_binary.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tempstack_8h_source.html">tempstack.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="term_8h_source.html">term.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="trace_8h_source.html">trace.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utils_8h_source.html">utils.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for memory.c:</div>
<div class="dyncontent">
<div class="center"><img src="memory_8c__incl.png" border="0" usemap="#a_2home_2runner_2work_2_atom_v_m_2_atom_v_m_2src_2lib_atom_v_m_2memory_8c" alt=""/></div>
<map name="a_2home_2runner_2work_2_atom_v_m_2_atom_v_m_2src_2lib_atom_v_m_2memory_8c" id="a_2home_2runner_2work_2_atom_v_m_2_atom_v_m_2src_2lib_atom_v_m_2memory_8c">
<area shape="rect" title=" " alt="" coords="1274,5,1523,47"/>
<area shape="rect" title=" " alt="" coords="1337,617,1407,644"/>
<area shape="rect" title=" " alt="" coords="1366,393,1437,420"/>
<area shape="rect" href="context_8h.html" title="Context struct and related management functions." alt="" coords="852,169,935,196"/>
<area shape="rect" href="list_8h.html" title=" " alt="" coords="866,543,921,569"/>
<area shape="rect" href="term_8h.html" title="term manipulation functions" alt="" coords="1053,319,1118,345"/>
<area shape="rect" href="memory_8h.html" title=" " alt="" coords="1222,543,1309,569"/>
<area shape="rect" href="utils_8h.html" title="Misc functions and macros." alt="" coords="963,617,1026,644"/>
<area shape="rect" href="refc__binary_8h.html" title=" " alt="" coords="1033,393,1138,420"/>
<area shape="rect" href="debug_8h.html" title="Debug functions and macros." alt="" coords="872,95,947,121"/>
<area shape="rect" href="dictionary_8h.html" title=" " alt="" coords="1213,244,1310,271"/>
<area shape="rect" href="erl__nif__priv_8h.html" title=" " alt="" coords="1153,95,1260,121"/>
<area shape="rect" href="tempstack_8h.html" title=" " alt="" coords="1486,543,1589,569"/>
<area shape="rect" href="trace_8h.html" title=" " alt="" coords="1715,95,1781,121"/>
<area shape="rect" href="globalcontext_8h.html" title="GlobalContext struct and related management functions." alt="" coords="424,244,547,271"/>
<area shape="rect" href="smp_8h.html" title="Multicore support functions." alt="" coords="387,468,450,495"/>
<area shape="rect" href="timer__list_8h.html" title=" " alt="" coords="243,468,339,495"/>
<area shape="rect" href="mailbox_8h.html" title="Mailbox management functions such as send and receive functions." alt="" coords="526,393,613,420"/>
<area shape="rect" title=" " alt="" coords="153,767,223,793"/>
<area shape="rect" href="atom_8h.html" title="Atoms manipulation functions." alt="" coords="99,468,167,495"/>
<area shape="rect" href="atom__table_8h.html" title=" " alt="" coords="195,319,303,345"/>
<area shape="rect" href="erl__nif_8h.html" title="Public API for nifs, compatible with Erlang/OTP API." alt="" coords="1085,617,1160,644"/>
<area shape="rect" href="synclist_8h.html" title=" " alt="" coords="495,319,579,345"/>
<area shape="rect" href="term__typedef_8h.html" title="term type definition" alt="" coords="1235,692,1357,719"/>
<area shape="rect" title=" " alt="" coords="1364,767,1439,793"/>
<area shape="rect" title=" " alt="" coords="1158,767,1229,793"/>
<area shape="rect" title=" " alt="" coords="1253,767,1339,793"/>
<area shape="rect" title=" " alt="" coords="525,543,608,569"/>
<area shape="rect" title=" " alt="" coords="352,543,451,569"/>
<area shape="rect" title=" " alt="" coords="739,393,805,420"/>
<area shape="rect" title=" " alt="" coords="957,692,1032,719"/>
<area shape="rect" href="resources_8h.html" title="Private data structures for nif object resources." alt="" coords="1185,468,1282,495"/>
</map>
</div>
</div>
<p><a href="memory_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:afa99ec4acc4ecb2dc3c2d05da15d0e3f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(a,  b)&#160;&#160;&#160;((a) &gt; (b) ? (a) : (b))</td></tr>
<tr class="separator:afa99ec4acc4ecb2dc3c2d05da15d0e3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacd814b3131a144344125d7094b9dc6d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#aacd814b3131a144344125d7094b9dc6d">FIBONACCI_HEAP_GROWTH_REDUCTION_THRESHOLD</a>&#160;&#160;&#160;10000</td></tr>
<tr class="separator:aacd814b3131a144344125d7094b9dc6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa34223a2c1aa426b283afb1e2461414a"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="memory_8h.html#a3d8bef9f86e567a8516760e56fdf085c">MemoryGCResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#aa34223a2c1aa426b283afb1e2461414a">memory_init_heap</a> (<a class="el" href="struct_heap.html">Heap</a> *heap, size_t size)</td></tr>
<tr class="memdesc:aa34223a2c1aa426b283afb1e2461414a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a root heap.  <a href="memory_8c.html#aa34223a2c1aa426b283afb1e2461414a">More...</a><br /></td></tr>
<tr class="separator:aa34223a2c1aa426b283afb1e2461414a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed7cb8e677736e46afa7fe2ef4313658"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#aed7cb8e677736e46afa7fe2ef4313658">memory_init_heap_root_fragment</a> (<a class="el" href="struct_heap.html">Heap</a> *heap, <a class="el" href="struct_heap_fragment.html">HeapFragment</a> *root, size_t size)</td></tr>
<tr class="memdesc:aed7cb8e677736e46afa7fe2ef4313658"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup heap from its root. Set the <code>mso_list</code> to NIL and initialize <code>heap_ptr</code>.  <a href="memory_8c.html#aed7cb8e677736e46afa7fe2ef4313658">More...</a><br /></td></tr>
<tr class="separator:aed7cb8e677736e46afa7fe2ef4313658"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a691d603e669393202b0fa9b99c404437"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="memory_8h.html#a3d8bef9f86e567a8516760e56fdf085c">MemoryGCResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#a691d603e669393202b0fa9b99c404437">memory_erl_nif_env_ensure_free</a> (<a class="el" href="struct_erl_nif_env.html">ErlNifEnv</a> *env, size_t size)</td></tr>
<tr class="memdesc:a691d603e669393202b0fa9b99c404437"><td class="mdescLeft">&#160;</td><td class="mdescRight">makes sure that the given nif environment has given free memory  <a href="memory_8c.html#a691d603e669393202b0fa9b99c404437">More...</a><br /></td></tr>
<tr class="separator:a691d603e669393202b0fa9b99c404437"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f22f826b7e8681cad1c4952c9c19629"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="memory_8h.html#a3d8bef9f86e567a8516760e56fdf085c">MemoryGCResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#a2f22f826b7e8681cad1c4952c9c19629">memory_ensure_free_with_roots</a> (<a class="el" href="struct_context.html">Context</a> *c, size_t size, size_t num_roots, <a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> *roots, enum <a class="el" href="memory_8h.html#aff62723a68c8c946c7d115a1cfaa4628">MemoryAllocMode</a> alloc_mode)</td></tr>
<tr class="memdesc:a2f22f826b7e8681cad1c4952c9c19629"><td class="mdescLeft">&#160;</td><td class="mdescRight">makes sure that the given context has given free memory.  <a href="memory_8c.html#a2f22f826b7e8681cad1c4952c9c19629">More...</a><br /></td></tr>
<tr class="separator:a2f22f826b7e8681cad1c4952c9c19629"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f2333ae6f2bceb4fb7c1effde5f648d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#a4f2333ae6f2bceb4fb7c1effde5f648d">memory_copy_term_tree</a> (<a class="el" href="struct_heap.html">Heap</a> *new_heap, <a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> t)</td></tr>
<tr class="memdesc:a4f2333ae6f2bceb4fb7c1effde5f648d"><td class="mdescLeft">&#160;</td><td class="mdescRight">copies a term to a destination heap  <a href="memory_8c.html#a4f2333ae6f2bceb4fb7c1effde5f648d">More...</a><br /></td></tr>
<tr class="separator:a4f2333ae6f2bceb4fb7c1effde5f648d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c3684abaa77ca5d5b07ba3960622b22"><td class="memItemLeft" align="right" valign="top"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#a6c3684abaa77ca5d5b07ba3960622b22">memory_copy_term_tree_to_storage</a> (<a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> *storage, <a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> **heap_end, <a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> t)</td></tr>
<tr class="memdesc:a6c3684abaa77ca5d5b07ba3960622b22"><td class="mdescLeft">&#160;</td><td class="mdescRight">copies a term to a storage, typically for mailbox messages  <a href="memory_8c.html#a6c3684abaa77ca5d5b07ba3960622b22">More...</a><br /></td></tr>
<tr class="separator:a6c3684abaa77ca5d5b07ba3960622b22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2ce659c9162754c8515fbd1b170fc9e"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#af2ce659c9162754c8515fbd1b170fc9e">memory_estimate_usage</a> (<a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> t)</td></tr>
<tr class="memdesc:af2ce659c9162754c8515fbd1b170fc9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">calculates term memory usage  <a href="memory_8c.html#af2ce659c9162754c8515fbd1b170fc9e">More...</a><br /></td></tr>
<tr class="separator:af2ce659c9162754c8515fbd1b170fc9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3585e49af06865398260c71ac8dead3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#ac3585e49af06865398260c71ac8dead3">memory_heap_append_fragment</a> (<a class="el" href="struct_heap.html">Heap</a> *heap, <a class="el" href="struct_heap_fragment.html">HeapFragment</a> *fragment, <a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> mso_list)</td></tr>
<tr class="memdesc:ac3585e49af06865398260c71ac8dead3"><td class="mdescLeft">&#160;</td><td class="mdescRight">append a fragment to a heap. The MSO list is merged. The fragment will then be owned by the heap.  <a href="memory_8c.html#ac3585e49af06865398260c71ac8dead3">More...</a><br /></td></tr>
<tr class="separator:ac3585e49af06865398260c71ac8dead3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83faa99cba2cd5a16becd07efaf5764f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8c.html#a83faa99cba2cd5a16becd07efaf5764f">memory_sweep_mso_list</a> (<a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> mso_list, <a class="el" href="struct_global_context.html">GlobalContext</a> *global)</td></tr>
<tr class="memdesc:a83faa99cba2cd5a16becd07efaf5764f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sweep any unreferenced binaries in the "Mark Sweep Object" (MSO) list.  <a href="memory_8c.html#a83faa99cba2cd5a16becd07efaf5764f">More...</a><br /></td></tr>
<tr class="separator:a83faa99cba2cd5a16becd07efaf5764f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aacd814b3131a144344125d7094b9dc6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacd814b3131a144344125d7094b9dc6d">&#9670;&nbsp;</a></span>FIBONACCI_HEAP_GROWTH_REDUCTION_THRESHOLD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FIBONACCI_HEAP_GROWTH_REDUCTION_THRESHOLD&#160;&#160;&#160;10000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00119">119</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<a id="afa99ec4acc4ecb2dc3c2d05da15d0e3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa99ec4acc4ecb2dc3c2d05da15d0e3f">&#9670;&nbsp;</a></span>MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">a, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((a) &gt; (b) ? (a) : (b))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00040">40</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a4f2333ae6f2bceb4fb7c1effde5f648d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f2333ae6f2bceb4fb7c1effde5f648d">&#9670;&nbsp;</a></span>memory_copy_term_tree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> memory_copy_term_tree </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_heap.html">Heap</a> *&#160;</td>
          <td class="paramname"><em>new_heap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a>&#160;</td>
          <td class="paramname"><em>t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>copies a term to a destination heap </p>
<p>deep copies a term to a destination heap, once finished old memory can be freed. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_heap</td><td>the destination heap where terms will be copied. </td></tr>
    <tr><td class="paramname">t</td><td>term to copy </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a new term that is stored on the new heap. </dd></dl>

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00333">333</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<a id="a6c3684abaa77ca5d5b07ba3960622b22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c3684abaa77ca5d5b07ba3960622b22">&#9670;&nbsp;</a></span>memory_copy_term_tree_to_storage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> memory_copy_term_tree_to_storage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> *&#160;</td>
          <td class="paramname"><em>storage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> **&#160;</td>
          <td class="paramname"><em>heap_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a>&#160;</td>
          <td class="paramname"><em>t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>copies a term to a storage, typically for mailbox messages </p>
<p>deep copies a term to a destination heap, once finished old memory can be freed. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">storage</td><td>storage for the copied data, should be large enough </td></tr>
    <tr><td class="paramname">heap_end</td><td>on output, pointer to the end of the term. </td></tr>
    <tr><td class="paramname">t</td><td>term to copy </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a boxed term pointer to the new term content that is stored in the storage. </dd></dl>

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00338">338</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<a id="a2f22f826b7e8681cad1c4952c9c19629"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f22f826b7e8681cad1c4952c9c19629">&#9670;&nbsp;</a></span>memory_ensure_free_with_roots()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="memory_8h.html#a3d8bef9f86e567a8516760e56fdf085c">MemoryGCResult</a> memory_ensure_free_with_roots </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_context.html">Context</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>num_roots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a> *&#160;</td>
          <td class="paramname"><em>roots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="memory_8h.html#aff62723a68c8c946c7d115a1cfaa4628">MemoryAllocMode</a>&#160;</td>
          <td class="paramname"><em>alloc_mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>makes sure that the given context has given free memory. </p>
<p>this function makes sure at least size terms are available. Optionally, it can allocate a fragment or shrink the heap to the specified size, depending on allocation strategy. The function can also be passed roots to update during any garbage collection. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>the target context. </td></tr>
    <tr><td class="paramname">size</td><td>needed available memory. </td></tr>
    <tr><td class="paramname">num_roots</td><td>number of roots </td></tr>
    <tr><td class="paramname">roots</td><td>roots to preserve </td></tr>
    <tr><td class="paramname">alloc_mode</td><td>constraint on allocation of additional memory </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00106">106</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<a id="a691d603e669393202b0fa9b99c404437"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a691d603e669393202b0fa9b99c404437">&#9670;&nbsp;</a></span>memory_erl_nif_env_ensure_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="memory_8h.html#a3d8bef9f86e567a8516760e56fdf085c">MemoryGCResult</a> memory_erl_nif_env_ensure_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_erl_nif_env.html">ErlNifEnv</a> *&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>makes sure that the given nif environment has given free memory </p>
<p>this function makes sure that at least size terms are available. When not available, a new fragment will be allocated. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">env</td><td>the target environment. </td></tr>
    <tr><td class="paramname">size</td><td>needed available memory. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00057">57</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<a id="af2ce659c9162754c8515fbd1b170fc9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2ce659c9162754c8515fbd1b170fc9e">&#9670;&nbsp;</a></span>memory_estimate_usage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long memory_estimate_usage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a>&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>calculates term memory usage </p>
<p>perform an used memory calculation using given term as root, shared memory (that is not part of the memory block) is not accounted. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>root term on which used memory calculation will be performed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>used memory terms count in term units output parameter. </dd></dl>

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00347">347</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<a id="ac3585e49af06865398260c71ac8dead3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3585e49af06865398260c71ac8dead3">&#9670;&nbsp;</a></span>memory_heap_append_fragment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memory_heap_append_fragment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_heap.html">Heap</a> *&#160;</td>
          <td class="paramname"><em>heap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_heap_fragment.html">HeapFragment</a> *&#160;</td>
          <td class="paramname"><em>fragment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a>&#160;</td>
          <td class="paramname"><em>mso_list</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>append a fragment to a heap. The MSO list is merged. The fragment will then be owned by the heap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap</td><td>the heap to append the fragment to </td></tr>
    <tr><td class="paramname">fragment</td><td>the fragment to add </td></tr>
    <tr><td class="paramname">mso_list</td><td>associated mso list or nil </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00677">677</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<a id="aa34223a2c1aa426b283afb1e2461414a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa34223a2c1aa426b283afb1e2461414a">&#9670;&nbsp;</a></span>memory_init_heap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="memory_8h.html#a3d8bef9f86e567a8516760e56fdf085c">MemoryGCResult</a> memory_init_heap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_heap.html">Heap</a> *&#160;</td>
          <td class="paramname"><em>heap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a root heap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap</td><td>heap to initialize. </td></tr>
    <tr><td class="paramname">size</td><td>capacity of the heap to create, not including the mso_list. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>MEMORY_GC_OK or MEMORY_GC_ERROR_FAILED_ALLOCATION depending on the outcome. </dd></dl>

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00044">44</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<a id="aed7cb8e677736e46afa7fe2ef4313658"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed7cb8e677736e46afa7fe2ef4313658">&#9670;&nbsp;</a></span>memory_init_heap_root_fragment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memory_init_heap_root_fragment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_heap.html">Heap</a> *&#160;</td>
          <td class="paramname"><em>heap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_heap_fragment.html">HeapFragment</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup heap from its root. Set the <code>mso_list</code> to NIL and initialize <code>heap_ptr</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap</td><td>heap to initialize. </td></tr>
    <tr><td class="paramname">root</td><td>fragment root. </td></tr>
    <tr><td class="paramname">size</td><td>capacity of the heap to create, not including the mso_list. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00057">57</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
<a id="a83faa99cba2cd5a16becd07efaf5764f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83faa99cba2cd5a16becd07efaf5764f">&#9670;&nbsp;</a></span>memory_sweep_mso_list()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memory_sweep_mso_list </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="term__typedef_8h.html#a603769ce1e8eeb1faa458d7e6cf904d8">term</a>&#160;</td>
          <td class="paramname"><em>mso_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_global_context.html">GlobalContext</a> *&#160;</td>
          <td class="paramname"><em>global</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sweep any unreferenced binaries in the "Mark Sweep Object" (MSO) list. </p>
<p>The MSO list is a list of term (references) in a heap. Currently, the elements of this list are referenced to reference-counted binaries or match binaries that themselves reference reference counted binaries. This function will iterate over the binaries in this list, and decrement the reference count of any elements that have not been marked for move (e.g., into a new heap). If the reference count reaches 0, then memory associated with the referenced binary will be freed.In a typical GC event, the terms in this list are within in the old heap or potentially in a heap fragment. However, this function may be called in a copy even, such as in a process spawn, or in the copy of a term to or from a process mailbox. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mso_list</td><td>the list of mark-sweep object in a heap "space" </td></tr>
    <tr><td class="paramname">global</td><td>the global context </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="memory_8c_source.html#l00707">707</a> of file <a class="el" href="memory_8c_source.html">memory.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
